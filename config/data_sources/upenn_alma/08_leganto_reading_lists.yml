---
load_sequence: 8

target_model: "CourseReserves::Leganto::ReadingList"
target_adapter: "csv"

export_file_name: "course_reserves_reading_lists.csv"

# Flag for the Alma API
source_adapter: "alma"
# URL Encoded report path
report_path: "path=%2Fshared%2FUniversity%20of%20Pennsylvania%2FReports%2FShared%20Reports%2Fmetridoc_reports%2Fleganto%2Fcourse_reserves_reading_lists"
apikey_string: "&apikey="
# Limit must be between 25 and 1000 and a multiple of 25
limit: "&limit=1000"

# API columns to MetriDoc column mapping
# Alma Uses the original column names, not what is assigned in the GUI
# As such, the SQL for any calculations need to be used as column names
column_mappings:
  "Reading List Id": reading_list_id
  "Reading List Associated to a Course": has_course_association
  "Reading List Creation Date": creation_date
  "Reading List Status": status
  "Reading List Modification Date": modification_date
  "Reading List Owner": owner
  "Reading List Owner Primary Identifier": owner_pennid
  "Number Of Citations": number_of_citations
  "Reading List Visible Start Date": visible_start_date
  "Reading List Visible End Date": visible_end_date

# Specify unique keys for the upload
unique_keys: ["reading_list_id"]
upsert: true

# List of specific columns to update on conflict
upsert_columns:
  - "modification_date"
  - "status"
  - "has_course_association"
  - "number_of_citations"
  - "visible_start_date"
  - "visible_end_date"
  - "owner"
  - "owner_pennid"

# Filter for request
incremental_filter_sql: '"Reading Lists"."Reading List Modification Date"'
incremental_filter_column: "modification_date"
